<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Tools and practices for FAIR research software: Code correctness</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="manifest" href="site.webmanifest"><link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo.svg"><span class="badge text-bg-warning">
          <abbr title="This lesson is in the alpha phase, which means that it has been taught once and lesson authors are iterating on feedback.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#field-testing-alpha-stage" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-triangle" style="border-radius: 5px"></i>
              Alpha
            </a>
            <span class="visually-hidden">This lesson is in the alpha phase, which means that it has been taught once and lesson authors are iterating on feedback.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/08-code-correctness.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Tools and practices for FAIR research software
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Tools and practices for FAIR research software
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="ci-for-testing.html">Continuous Integration for automated testing</a></li><li><a class="dropdown-item" href="licensing.html">Software licensing</a></li><li><a class="dropdown-item" href="ethical-environmental-considerations.html">Ethical &amp; environmental considerations around research software</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Tools and practices for FAIR research software
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 63%" class="percentage">
    63%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 63%" aria-valuenow="63" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/08-code-correctness.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-introduction.html">1. Course introduction</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-fair-research-software.html">2. FAIR research software</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-tools.html">3. Tools and practices for FAIR research software development</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-version-control.html">4. Version control</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-code-environment.html">5. Reproducible development environment</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06-code-readability.html">6. Code readability</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-code-structure.html">7. Code structure</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        8. Code correctness
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#why-use-software-testing">Why use software testing?</a></li>
<li><a href="#types-of-software-tests">Types of software tests</a></li>
<li><a href="#informal-testing">Informal testing</a></li>
<li><a href="#formal-testing">Formal testing</a></li>
<li><a href="#using-a-testing-framework">Using a testing framework</a></li>
<li><a href="#test-suite-design">Test Suite Design</a></li>
<li><a href="#improving-our-code">Improving Our Code</a></li>
<li><a href="#continuous-integration-for-automated-testing">Continuous Integration for automated testing</a></li>
<li><a href="#summary">Summary</a></li>
<li><a href="#further-reading">Further reading</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="09-code-documentation.html">9. Code documentation</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush11">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading11">
        <a href="10-open-collaboration.html">10. Open collaboration on code</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush12">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading12">
        <a href="11-wrap-up.html">11. Wrap-up</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="ci-for-testing.html">Continuous Integration for automated testing</a></li><li><a href="licensing.html">Software licensing</a></li><li><a href="ethical-environmental-considerations.html">Ethical &amp; environmental considerations around research software</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="07-code-structure.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="09-code-documentation.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="07-code-structure.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Code structure
        </a>
        <a class="chapter-link float-end" href="09-code-documentation.html" rel="next">
          Next: Code documentation...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Code correctness</h1>
        <p>Last updated on 2024-09-17 |

        <a href="https://github.com/softwaresaved/fair-research-software/edit/main/episodes/08-code-correctness.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How can we verify that our code is correct?</li>
<li>How can we automate our software tests?</li>
<li>What makes a “good” test?</li>
<li>Which parts of our code should we prioritize for testing?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to:</p>
<ul><li>Explain why code testing is important and how this supports FAIR
software.</li>
<li>Describe the different types of software tests (unit tests,
integration tests, regression tests).</li>
<li>Implement unit tests to verify that function(s) behave as expected
using the Python testing framework <code>pytest</code>.</li>
<li>Interpret the output from <code>pytest</code> to identify which
function(s) are not behaving as expected.</li>
<li>Write tests using typical values, edge cases and invalid inputs to
ensure that the code can handle extreme values and invalid inputs
appropriately.</li>
<li>Evaluate code coverage to identify how much of the codebase is being
tested and identify areas that need further tests.</li>
</ul></div>
</div>
</div>
</div>
</div>
<p>Now that we have improved the structure and readability of our code -
it is much easier to test its functionality and improve it further. The
goal of software testing is to check that the actual results produced by
a piece of code meet our expectations, i.e. are correct.</p>
<p>Before we move on with further code modifications, make sure your
virtual development environment is active.</p>

<section><h2 class="section-heading" id="why-use-software-testing">Why use software testing?<a class="anchor" aria-label="anchor" href="#why-use-software-testing"></a></h2>
<hr class="half-width"><p>Adopting software testing as part of our research workflow helps us
to conduct <strong>better research</strong> and produce <strong>FAIR
software</strong>:</p>
<ul><li>Software testing can help us be more productive as it helps us to
identify and fix problems with our code early and quickly and allows us
to demonstrate to ourselves and others that our code does what we claim.
More importantly, we can share our tests alongside our code, allowing
others to verify our software for themselves.</li>
<li>The act of writing tests encourages to structure our code as
individual functions and often results in a more
<strong>readable</strong>, modular and maintainable codebase that is
easier to extend or repurpose.</li>
<li>Software testing improves the <strong>accessibility</strong> and
<strong>reusability</strong> of our code - well-written software tests
capture the expected behaviour of our code and can be used alongside
documentation to help other developers quickly make sense of our code.
In addition, a well tested codebase allows developers to experiment with
new features safe in the knowledge that tests will reveal if their
changes have broken any existing functionality.</li>
<li>Software testing underpins the FAIR process by giving us the
confidence to engage in open research practices - if we are not sure
that our code works as intended and produces accurate results, we are
unlikely to feel confident about sharing our code with others. Software
testing brings piece of mind by providing a step-by-step approach that
we can apply to verify that our code is correct.</li>
</ul></section><section><h2 class="section-heading" id="types-of-software-tests">Types of software tests<a class="anchor" aria-label="anchor" href="#types-of-software-tests"></a></h2>
<hr class="half-width"><p>There are many different types of software testing.</p>
<ul><li><p><strong>Unit tests</strong> focus on testing individual functions
in isolation. They ensure that each small part of the software performs
as intended. By verifying the correctness of these individual units, we
can catch errors early in the development process.</p></li>
<li><p><strong>Integration tests</strong> check how different parts of
the code e.g. functions work together.</p></li>
<li><p><strong>Regression tests</strong> are used to ensure that new
changes or updates to the codebase do not adversely affect the existing
functionality. They involve checking whether a program or part of a
program still generates the same results after changes have been
made.</p></li>
<li><p><strong>End-to-end</strong> tests are a special type of
integration testing which checks that a program as a whole behaves as
expected.</p></li>
</ul><p>In this course, our primary focus will be on unit testing. However,
the concepts and techniques we cover will provide a solid foundation
applicable to other types of testing.</p>
<div id="types-of-software-tests-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="types-of-software-tests-1" class="callout-inner">
<h3 class="callout-title">Types of software tests</h3>
<div class="callout-content">
<p>Fill in the blanks in the sentences below:</p>
<ul><li>__________ tests compare the ______ output of a program to its
________ output to demonstrate correctness.</li>
<li>Unit tests compare the actual output of a ______ ________ to the
expected output to demonstrate correctness.</li>
<li>__________ tests check that results have not changed since the
previous test run.</li>
<li>__________ tests check that two or more parts of a program are
working together correctly.</li>
</ul></div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<ul><li>End-to-end tests compare the actual output of a program to the
expected output to demonstrate correctness.</li>
<li>Unit tests compare the actual output of a single function to the
expected output to demonstrate correctness.</li>
<li>Regression tests check that results have not changed since the
previous test run.</li>
<li>Integration tests check that two or more parts of a program are
working together correctly.</li>
</ul></div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="informal-testing">Informal testing<a class="anchor" aria-label="anchor" href="#informal-testing"></a></h2>
<hr class="half-width"><p><strong>How should we test our code?</strong> Let’s start by
considering the following scenario. A collaborator on our project has
sent us the following code to add a <code>crew_size</code> variable to
our data frame - a column which captures the number of astronauts
participating in a given spacewalk. How do we know that it works as
intended?</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="im">import</span> pandas</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="kw">def</span> calculate_crew_size(crew):</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">    Calculate crew_size for a single crew entry</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">        crew (str): The text entry in the crew column</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">        int: The crew size</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>    <span class="cf">if</span> crew.split() <span class="op">==</span> []:</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(re.split(<span class="vs">r';'</span>, crew))<span class="op">-</span><span class="dv">1</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="kw">def</span> add_crew_size_variable(df_):</span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a><span class="co">    Add crew size (crew_size) variable to the dataset</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a><span class="co">        df_ (pd.DataFrame): The input data frame.</span></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a><span class="co">        df_copy (pd.DataFrame): A copy of df_ with the new crew_size variable added</span></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Adding crew size variable (crew_size) to dataset'</span>)</span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a>    df_copy <span class="op">=</span> df_.copy()</span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a>    df_copy[<span class="st">"crew_size"</span>] <span class="op">=</span> df_copy[<span class="st">"crew"</span>].<span class="bu">apply</span>(</span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a>        calculate_crew_size</span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a>    )</span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a>    <span class="cf">return</span> df_copy</span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a>    </span></code></pre>
</div>
<p>One approach is to copy/paste the function(s) into a python
interpreter and check that they behave as expected with some input
values where we know what the correct return value should be.</p>
<p>Since <code>add_crew_size_variable</code> contains boiler plate code
for deriving one column from another let’s start with
<code>calculate_crew_size</code>:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>calculate_crew_size(<span class="st">"Valentina Tereshkova;"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>calculate_crew_size(<span class="st">"Judith Resnik; Sally Ride;"</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fl">1</span></span>
<span><span class="fl">2</span></span></code></pre>
</div>
<p>We can then explore the behaviour of
<code>add_crew_size_variable</code> by creating a toy data frame:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># Create a toy DataFrame</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>data <span class="op">=</span> pd.DataFrame({</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>    <span class="st">'crew'</span>: [<span class="st">'Anna Lee Fisher;'</span>, <span class="st">'Marsha Ivins; Helen Sharman;'</span>]</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>})</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>add_crew_size_variable(data)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Adding crew size variable (crew_size) to dataset
                           crew  crew_size
0              Anna Lee Fisher;          1
1  Marsha Ivins; Helen Sharman;          2</code></pre>
</div>
<p>Although this is an important process to go through as we draft our
code for the first time, there are some serious drawbacks to this
approach if used as our only form of testing.</p>
<div id="what-are-the-limitations-of-informally-testing-code-5-minutes" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="what-are-the-limitations-of-informally-testing-code-5-minutes" class="callout-inner">
<h3 class="callout-title">What are the limitations of informally testing code? (5 minutes)</h3>
<div class="callout-content">
<p>Think about the questions below. Your instructors may ask you to
share your answers in a shared notes document and/or discuss them with
other participants.</p>
<ul><li>Why might we choose to test our code informally?</li>
<li>What are the limitations of relying solely on informal tests to
verify that a piece of code is behaving as expected?</li>
</ul></div>
</div>
</div>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Discussion Spoilers </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" aria-labelledby="headingSpoiler1" data-bs-parent="#accordionSpoiler1">
<div class="accordion-body">
<p>It can be tempting to test our code informally because this
approach:</p>
<ul><li>is quick and easy</li>
<li>provides immediate feedback</li>
</ul><p>However, there are limitations to this approach:</p>
<ul><li>Working interactively is error prone</li>
<li>We must repeat our tests every time we update our code; this is time
consuming</li>
<li>We must rely on memory to keep track of how we have tested our code
e.g. what input values we tried</li>
<li>We must rely on memory to keep track of which functions have been
tested and which have not</li>
</ul></div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="formal-testing">Formal testing<a class="anchor" aria-label="anchor" href="#formal-testing"></a></h2>
<hr class="half-width"><p>We can overcome some of these limitations by formalising our testing
process. A formal approach to testing our function(s) is to write
dedicated test functions to check our code. These test functions:</p>
<ul><li>Run the function we want to test - the target function with known
inputs</li>
<li>Compare the output to known, valid results</li>
<li>Raises an error if the function’s actual output does not match the
expected output</li>
<li>Are recorded in a test script that can be re-run on demand.</li>
</ul><p>Let’s explore this process by writing some formal tests for our
<code>text_to_duration</code> function. (We’ll come back to our
colleague’s calculate_crew_size function later).</p>
<p>The <code>text_to_duration</code> function converts a duration stored
as a string (HH:MM) to a duration in hours e.g. duration “1.15” should
return a value of 1.25.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="kw">def</span> text_to_duration(duration):</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co">    Convert a text format duration "HH:MM" to duration in hours</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">        duration (str): The text format duration</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">        float: The duration in hours</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>    hours, minutes <span class="op">=</span> duration.split(<span class="st">":"</span>)</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>    duration_hours <span class="op">=</span> <span class="bu">int</span>(hours) <span class="op">+</span> <span class="bu">int</span>(minutes)<span class="op">/</span><span class="dv">60</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>    <span class="cf">return</span> duration_hours</span></code></pre>
</div>
<p>Let’s create a new python file <code>test_code.py</code> in the root
of our project folder to store our tests.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> cd spacewalks</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> touch test_code.py</span></code></pre>
</div>
<p>First, we import text_to_duration into our test script. Then, we then
add our first test function:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="im">from</span> eva_data_analysis <span class="im">import</span> text_to_duration</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="kw">def</span> test_text_to_duration_integer():</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>    input_value <span class="op">=</span> <span class="st">"10:00"</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>    test_result <span class="op">=</span> text_to_duration(<span class="st">"10:00"</span>) <span class="op">==</span> <span class="dv">10</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"text_to_duration('10:00') == 10? </span><span class="sc">{</span>test_result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>test_text_to_duration()</span></code></pre>
</div>
<p>This test checks that when we apply text_to_duration to input value
“10:00”, the output matches the expected value of 10.</p>
<p>In this example, we use a print statement to report whether the
actual output from text_to_duration meets our expectations.</p>
<p>However, this does not meet our requirement to “Raise an error if the
function’s output does not match the expected output” and means that we
must carefully read our test function’s output to identify whether it
has failed.</p>
<p>To ensure that our code raises an error if the function’s output does
not match the expected output, we can use an assert statement.</p>
<p>The assert statement in Python checks whether a condition is True or
False. If the statement is True, then assert does not return a value but
if the statement is false, then assert raises an AssertError.</p>
<p>Let’s rewrite our test with an assert statement:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="im">from</span> eva_data_analysis <span class="im">import</span> text_to_duration</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="kw">def</span> test_text_to_duration_integer():</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>    <span class="cf">assert</span> text_to_duration(<span class="st">"10:00"</span>) <span class="op">==</span> <span class="dv">10</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>test_text_to_duration_integer()</span></code></pre>
</div>
<p>Notice that when we run test_text_to_duration_integer(), nothing
happens - there is no output. That is because our function is working
correctly and returning the expected value of 10.</p>
<p>Let’s see what happens when we deliberately introduce a bug into
<code>text_to_duration</code>: In the Spacewalks data analysis script
let’s change <code>int(hours)</code> to <code>int(hour)/60</code> and
<code>int(minutes)/60</code> to <code>int(minutes)</code>to mimic a
simple mistake in our code where the wrong element is divided by 60.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="kw">def</span> text_to_duration(duration):</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co">    Convert a text format duration "HH:MM" to duration in hours</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="co">        duration (str): The text format duration</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co">        duration (float): The duration in hours</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>    hours, minutes <span class="op">=</span> duration.split(<span class="st">":"</span>)</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>    duration_hours <span class="op">=</span> <span class="bu">int</span>(hours)<span class="op">/</span><span class="dv">60</span> <span class="op">+</span> <span class="bu">int</span>(minutes) <span class="co"># Divide the wrong element by 60</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>    <span class="cf">return</span> duration_hours</span></code></pre>
</div>
<p>Notice that this time, our test fails noisily. Our assert statement
has raised an <code>AssertionError</code> - a clear signal that there is
a problem in our code that we need to fix.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>test_text_to_duration_integer()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Traceback (most recent call last):
  File "/Users/AnnResearchers/Desktop/Spacewalks/test_code.py", line 7, in &lt;module&gt;
    test_text_to_duration_integer()
  File "/Users/AnnResearchers/Desktop/Spacewalks/test_code.py", line 5, in test_text_to_duration_integer
    assert text_to_duration("10:00") == 10
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError</code></pre>
</div>
<p>What happens if we add another test to our test script? This time
we’ll check that our function can handle durations with a non-zero
minute component. Notice that this time our expected value is a
floating-point number. Importantly, we cannot use a simple double equals
sign (<code>==</code>) to compare the equality of floating-point
numbers. Floating-point arithmetic can introduce very small differences
due to how computers represent these numbers internally - as a result,
we check that our floating point numbers are equal within a very small
tolerance (1e-5).</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="im">from</span> eva_data_analysis <span class="im">import</span> text_to_duration</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="kw">def</span> test_text_to_duration_integer():</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>    <span class="cf">assert</span> text_to_duration(<span class="st">"10:00"</span>) <span class="op">==</span> <span class="dv">10</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>    </span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="kw">def</span> test_text_to_duration_float():</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">abs</span>(text_to_duration(<span class="st">"10:20"</span>) <span class="op">-</span> <span class="fl">10.33333333</span>) <span class="op">&lt;</span> <span class="fl">1e-5</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>test_text_to_duration_integer()</span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>test_text_to_duration_float()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Traceback (most recent call last):
  File "/Users/AnnResearcher/Desktop/Spacewalks/test_code.py", line 9, in &lt;module&gt;
    test_text_to_duration_integer()
  File "/Users/AnnResearcher/Desktop/Spacewalks/test_code.py", line 4, in test_text_to_duration_integer
    assert text_to_duration("10:00") == 10
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError</code></pre>
</div>
<p>What happens when we run our updated test script? Our script stops
after the first test failure and the second test is not run. To run our
remaining tests we would have to manually comment out our failing test
and re-run the test script. As our code base and tests grow, this will
become cumbersome. This is not ideal and can be overcome by automating
our tests using a testing framework.</p>
</section><section><h2 class="section-heading" id="using-a-testing-framework">Using a testing framework<a class="anchor" aria-label="anchor" href="#using-a-testing-framework"></a></h2>
<hr class="half-width"><p>Our approach so far has had two major limitations:</p>
<ul><li>We had to carefully examine the output of our test script to work
out if our test failed.</li>
<li>Our test script only ran our tests up to the first test
failure.</li>
</ul><p>We can do better than this! Testing frameworks can automatically find
all the tests in our code base, run all of them and present the test
results as a readable summary.</p>
<p>We will use the python testing framework pytest with its code
coverage plugin pytest-cov. To install these libraries, open a terminal
and type:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> python <span class="at">-m</span> pip install pytest pytest-cov</span></code></pre>
</div>
<p>Make sure to also capture the changes to our virtual development
environment.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> python <span class="at">-m</span> pip freeze <span class="op">&gt;</span> requirements.txt</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> git add requirements.txt</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> git commit <span class="at">-m</span> <span class="st">"Added pytest and pytest-cov libraries."</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> git push origin main</span></code></pre>
</div>
<p>Let’s make sure that our tests are ready to work with pytest.</p>
<ul><li>
<p>pytest automatically discovers tests based on specific naming
patterns. pytest looks for files that start with <code>test_</code> or
end with <code>_test.py</code>. Then, within these files, pytest looks
for functions that start with test_.<br>
Our test file already meets these requirements, so there is nothing to
do here. However, our script does contain lines to run each of our test
functions. These are no-longer required as pytest will run our tests so
we will remove them:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># Delete</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>test_text_to_duration_integer()</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>test_text_to_duration_float()</span></code></pre>
</div>
</li>
<li><p>It is also conventional when working with a testing framework to
place test files in a tests directory at the root of our project and to
name each test file after the code file that it targets. This helps in
maintaining a clean structure and makes it easier for others to
understand where the tests are located.</p></li>
</ul><p>A set of tests for a given piece of code is called a test suite. Our
test suite is currently located in the root folder of our project. Let’s
move it to a dedicated test folder and rename our test_code.py file to
test_eva_analysis.py.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> mkdir tests</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> mv test_code.py tests/test_eva_analysis.py</span></code></pre>
</div>
<p>Before we re-run our tests using pytest, let’s update our second
test. to use pytest’s <code>approx</code> function which is specifically
intended for comparing floating point numbers within a tolerance.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="im">from</span> eva_data_analysis <span class="im">import</span> text_to_duration</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="kw">def</span> test_text_to_duration_integer():</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>    <span class="cf">assert</span> text_to_duration(<span class="st">"10:00"</span>) <span class="op">==</span> <span class="dv">10</span></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>    </span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a><span class="kw">def</span> test_text_to_duration_float():</span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>    <span class="cf">assert</span> text_to_duration(<span class="st">"10:20"</span>) <span class="op">==</span> pytest.approx(<span class="fl">10.33333333</span>)</span></code></pre>
</div>
<p>Let’s also add some inline comments to clarify what each test is
doing and expand our syntax to highlight the logic behind our
approach:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="im">from</span> eva_data_analysis <span class="im">import</span> text_to_duration</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a><span class="kw">def</span> test_text_to_duration_integer():</span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a><span class="co">    Test that text_to_duration returns expected ground truth values</span></span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a><span class="co">    for typical whole hour durations </span></span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a>    actual_result <span class="op">=</span>  text_to_duration(<span class="st">"10:00"</span>)</span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a>    expected_result <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a>    <span class="cf">assert</span> actual_result <span class="op">==</span> expected_result</span>
<span id="cb22-12"><a href="#cb22-12" tabindex="-1"></a>    </span>
<span id="cb22-13"><a href="#cb22-13" tabindex="-1"></a><span class="kw">def</span> test_text_to_duration_float():</span>
<span id="cb22-14"><a href="#cb22-14" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb22-15"><a href="#cb22-15" tabindex="-1"></a><span class="co">    Test that text_to_duration returns expected ground truth values</span></span>
<span id="cb22-16"><a href="#cb22-16" tabindex="-1"></a><span class="co">    for typical durations with a non-zero minute component</span></span>
<span id="cb22-17"><a href="#cb22-17" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb22-18"><a href="#cb22-18" tabindex="-1"></a>    actual_result <span class="op">=</span> text_to_duration(<span class="st">"10:20"</span>) </span>
<span id="cb22-19"><a href="#cb22-19" tabindex="-1"></a>    expected_result <span class="op">=</span> <span class="fl">10.33333333</span></span>
<span id="cb22-20"><a href="#cb22-20" tabindex="-1"></a>    <span class="cf">assert</span> actual_result <span class="op">==</span> pytest.approx(expected_result)</span></code></pre>
</div>
<p>Writing our tests this way highlights the key idea that each test
should compare the actual results returned by our function with expected
values.</p>
<p>Similarly, writing inline comments for our tests that complete the
sentence “Test that …” helps us to understand what each test is doing
and why it is needed.</p>
<p>Finally, let’s also modify our bug to something that will affect
durations with a non-zero minute component like “10:20” but not those
that are whole hours e.g. “10:00”.</p>
<p>Let’s change <code>int(hours)/60 + int(minutes)</code> to
<code>int(hours) + int(minutes)/6</code> a simple typo.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="kw">def</span> text_to_duration(duration):</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a><span class="co">    Convert a text format duration "HH:MM" to duration in hours</span></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a><span class="co">        duration (str): The text format duration</span></span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a><span class="co">        duration (float): The duration in hours</span></span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a>    hours, minutes <span class="op">=</span> duration.split(<span class="st">":"</span>)</span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a>    duration_hours <span class="op">=</span> <span class="bu">int</span>(hours) <span class="op">+</span> <span class="bu">int</span>(minutes)<span class="op">/</span><span class="dv">6</span> <span class="co"># Divide by 6 instead of 60</span></span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a>    <span class="cf">return</span> duration_hours</span></code></pre>
</div>
<p>Finally, let’s run our tests:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> python <span class="at">-m</span> pytest </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>========================================================== test session starts
platform darwin -- Python 3.12.3, pytest-8.2.2, pluggy-1.5.0
rootdir: /Users/AnnResearcher/Desktop/Spacewalks
plugins: cov-5.0.0
collected 2 items

tests/test_eva_data_analysis.py .F                                                                                                 [100%]

================================================================ FAILURES
______________________________________________________ test_text_to_duration_float

    def test_text_to_duration_float():
        """
        Test that text_to_duration returns expected ground truth values
        for typical durations with a non-zero minute component
        """
        actual_result = text_to_duration("10:20")
        expected_result = 10.33333333
&gt;       assert actual_result == pytest.approx(expected_result)
E       assert 13.333333333333334 == 10.33333333 ± 1.0e-05
E
E         comparison failed
E         Obtained: 13.333333333333334
E         Expected: 10.33333333 ± 1.0e-05

tests/test_eva_data_analysis.py:23: AssertionError
======================================================== short test summary info
FAILED tests/test_eva_data_analysis.py::test_text_to_duration_float - assert 13.333333333333334 == 10.33333333 ± 1.0e-05
====================================================== 1 failed, 1 passed in 0.32s</code></pre>
</div>
<ul><li>Notice how if the test function finishes without triggering an
assertion, the test is considered successful and is marked with a dot
(‘.’).</li>
<li>If an assertion fails or an error occurs, the test is marked as a
failure with an ‘F’. and the output includes details about the error to
help identify what went wrong.</li>
</ul><div id="interpreting-pytest-output" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="interpreting-pytest-output" class="callout-inner">
<h3 class="callout-title">Interpreting pytest output</h3>
<div class="callout-content">
<p>A colleague has asked you to conduct a pre-publication review of
their code <code>Spacetravel</code> which analyses time spent in space
by various individual astronauts.</p>
<p>Inspect the pytest output provided and answer the questions
below.</p>
<div class="section level3">
<h3 id="pytest-output-for-spacetravel">pytest output for <code>Spacetravel</code>
<a class="anchor" aria-label="anchor" href="#pytest-output-for-spacetravel"></a></h3>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>============================================================ test session starts
platform darwin -- Python 3.12.3, pytest-8.2.2, pluggy-1.5.0
rootdir: /Users/Desktop/AnneResearcher/projects/Spacetravel
collected 9 items

tests/test_analyse.py FF....                                              [ 66%]
tests/test_prepare.py s..                                                 [100%]

====================================================================== FAILURES
____________________________________________________________ test_total_duration

    def test_total_duration():

      durations = [10, 15, 20, 5]
      expected  = 50/60
      actual  = calculate_total_duration(durations)
&gt;     assert actual == pytest.approx(expected)
E     assert 8.333333333333334 == 0.8333333333333334 ± 8.3e-07
E
E       comparison failed
E       Obtained: 8.333333333333334
E       Expected: 0.8333333333333334 ± 8.3e-07

tests/test_analyse.py:9: AssertionError
______________________________________________________________________________ test_mean_duration

    def test_mean_duration():
       durations = [10, 15, 20, 5]

       expected = 12.5/60
&gt;      actual  = calculate_mean_duration(durations)

tests/test_analyse.py:15:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

durations = [10, 15, 20, 5]

    def calculate_mean_duration(durations):
        """
        Calculate the mean of a list of durations.
        """
        total_duration = sum(durations)/60
&gt;       mean_duration = total_duration / length(durations)
E       NameError: name 'length' is not defined

Spacetravel.py:45: NameError
=========================================================================== short test summary info
FAILED tests/test_analyse.py::test_total_duration - assert 8.333333333333334 == 0.8333333333333334 ± 8.3e-07
FAILED tests/test_analyse.py::test_mean_duration - NameError: name 'length' is not defined
============================================================== 2 failed, 6 passed, 1 skipped in 0.02s </code></pre>
</div>
<ol style="list-style-type: lower-alpha"><li>How many tests has our colleague included in the test suite?</li>
<li>The first test in test_prepare.py has a status of s; what does this
mean?</li>
<li>How many tests failed?</li>
<li>Why did “test_total_duration” fail?</li>
<li>Why did “test_mean_duration” fail?</li>
</ol></div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<ol style="list-style-type: lower-alpha"><li>9 tests were detected in the test suite</li>
<li>s - stands for “skipped”,</li>
<li>2 tests failed: the first and second tests in test file
<code>test_analyse.py</code>
</li>
<li>
<code>test_total_duration</code> failed because the calculated total
duration differs from the expected value by a factor of 10 i.e. the
assertion <code>actual == pytest.approx(expected)</code> evaluated to
<code>False</code>
</li>
<li>
<code>test_mean_duration</code> failed because there is a syntax
error in <code>calculate_mean_duration</code>. Our colleague has used
the command <code>length</code> (not a python command) instead of
<code>len</code>. As a result, running the function returns a
<code>NameError</code> rather than a calculated value and the test
assertion evaluates to <code>False</code>.</li>
</ol></div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="test-suite-design">Test Suite Design<a class="anchor" aria-label="anchor" href="#test-suite-design"></a></h2>
<hr class="half-width"><p>Now that we have tooling in place to automatically run our test
suite. What makes a good test suite?</p>
<div class="section level3">
<h3 id="good-tests">Good Tests<a class="anchor" aria-label="anchor" href="#good-tests"></a></h3>
<p>We should aim to test that our function behaves as expected with the
full range of inputs that it might encounter. It is helpful to consider
each argument of a function in turn and identify the range of typical
values it can take. Once we have identified this typical range or ranges
(where a function takes more than one argument), we should:</p>
<ul><li>Test at least one interior point</li>
<li>Test all values at the edge of the range</li>
<li>Test invalid values</li>
</ul><p>Let’s revisit the <code>crew_size</code> functions from our
colleague’s codebase. First let’s add the the additional functions to
<code>eva_data_analysis.py</code>:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a>...</span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a><span class="kw">def</span> calculate_crew_size(crew):</span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a><span class="co">    Calculate crew_size for a single crew entry</span></span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a><span class="co">        crew (str): The text entry in the crew column</span></span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a><span class="co">        int: The crew size</span></span>
<span id="cb27-17"><a href="#cb27-17" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb27-18"><a href="#cb27-18" tabindex="-1"></a>    <span class="cf">if</span> crew.split() <span class="op">==</span> []:</span>
<span id="cb27-19"><a href="#cb27-19" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb27-20"><a href="#cb27-20" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb27-21"><a href="#cb27-21" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(re.split(<span class="vs">r';'</span>, crew))<span class="op">-</span><span class="dv">1</span></span>
<span id="cb27-22"><a href="#cb27-22" tabindex="-1"></a></span>
<span id="cb27-23"><a href="#cb27-23" tabindex="-1"></a></span>
<span id="cb27-24"><a href="#cb27-24" tabindex="-1"></a><span class="kw">def</span> add_crew_size_variable(df_):</span>
<span id="cb27-25"><a href="#cb27-25" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb27-26"><a href="#cb27-26" tabindex="-1"></a><span class="co">    Add crew size (crew_size) variable to the dataset</span></span>
<span id="cb27-27"><a href="#cb27-27" tabindex="-1"></a></span>
<span id="cb27-28"><a href="#cb27-28" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb27-29"><a href="#cb27-29" tabindex="-1"></a><span class="co">        df_ (pd.DataFrame): The input data frame.</span></span>
<span id="cb27-30"><a href="#cb27-30" tabindex="-1"></a></span>
<span id="cb27-31"><a href="#cb27-31" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb27-32"><a href="#cb27-32" tabindex="-1"></a><span class="co">        df_copy (pd.DataFrame): A copy of df_ with the new crew_size variable added</span></span>
<span id="cb27-33"><a href="#cb27-33" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb27-34"><a href="#cb27-34" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Adding crew size variable (crew_size) to dataset'</span>)</span>
<span id="cb27-35"><a href="#cb27-35" tabindex="-1"></a>    df_copy <span class="op">=</span> df_.copy()</span>
<span id="cb27-36"><a href="#cb27-36" tabindex="-1"></a>    df_copy[<span class="st">"crew_size"</span>] <span class="op">=</span> df_copy[<span class="st">"crew"</span>].<span class="bu">apply</span>(</span>
<span id="cb27-37"><a href="#cb27-37" tabindex="-1"></a>        calculate_crew_size</span>
<span id="cb27-38"><a href="#cb27-38" tabindex="-1"></a>    )</span>
<span id="cb27-39"><a href="#cb27-39" tabindex="-1"></a>    <span class="cf">return</span> df_copy</span>
<span id="cb27-40"><a href="#cb27-40" tabindex="-1"></a></span>
<span id="cb27-41"><a href="#cb27-41" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb27-42"><a href="#cb27-42" tabindex="-1"></a></span>
<span id="cb27-43"><a href="#cb27-43" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(sys.argv) <span class="op">&lt;</span> <span class="dv">3</span>:</span>
<span id="cb27-44"><a href="#cb27-44" tabindex="-1"></a>        input_file <span class="op">=</span> <span class="st">'./eva-data.json'</span></span>
<span id="cb27-45"><a href="#cb27-45" tabindex="-1"></a>        output_file <span class="op">=</span> <span class="st">'./eva-data.csv'</span></span>
<span id="cb27-46"><a href="#cb27-46" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Using default input and output filenames'</span>)</span>
<span id="cb27-47"><a href="#cb27-47" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb27-48"><a href="#cb27-48" tabindex="-1"></a>        input_file <span class="op">=</span> sys.argv[<span class="dv">1</span>]</span>
<span id="cb27-49"><a href="#cb27-49" tabindex="-1"></a>        output_file <span class="op">=</span> sys.argv[<span class="dv">2</span>]</span>
<span id="cb27-50"><a href="#cb27-50" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'Using custom input and output filenames'</span>)</span>
<span id="cb27-51"><a href="#cb27-51" tabindex="-1"></a></span>
<span id="cb27-52"><a href="#cb27-52" tabindex="-1"></a>    graph_file <span class="op">=</span> <span class="st">'./cumulative_eva_graph.png'</span></span>
<span id="cb27-53"><a href="#cb27-53" tabindex="-1"></a></span>
<span id="cb27-54"><a href="#cb27-54" tabindex="-1"></a>    eva_data <span class="op">=</span> read_json_to_dataframe(input_file)</span>
<span id="cb27-55"><a href="#cb27-55" tabindex="-1"></a></span>
<span id="cb27-56"><a href="#cb27-56" tabindex="-1"></a>    eva_data_prepared <span class="op">=</span> add_crew_size_variable(eva_data)  <span class="co"># Add this line</span></span>
<span id="cb27-57"><a href="#cb27-57" tabindex="-1"></a></span>
<span id="cb27-58"><a href="#cb27-58" tabindex="-1"></a>    write_dataframe_to_csv(eva_data_prepared, output_file)  <span class="co"># Modify this line</span></span>
<span id="cb27-59"><a href="#cb27-59" tabindex="-1"></a></span>
<span id="cb27-60"><a href="#cb27-60" tabindex="-1"></a>    plot_cumulative_time_in_space(eva_data_prepared, graph_file) <span class="co"># Modify this line</span></span>
<span id="cb27-61"><a href="#cb27-61" tabindex="-1"></a></span>
<span id="cb27-62"><a href="#cb27-62" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"--END--"</span>)</span></code></pre>
</div>
<p>Now, let’s write some tests for <code>calculate_crew_size</code>.</p>
<div id="unit-tests-for-calculate_crew_size" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="unit-tests-for-calculate_crew_size" class="callout-inner">
<h3 class="callout-title">Unit Tests for calculate_crew_size</h3>
<div class="callout-content">
<p>Implement unit tests for the <code>calculate_crew_size</code>
function. Cover typical cases and edge cases.</p>
<p>Hint: use the following template:</p>
<pre><code>def test_MYFUNCTION (): # FIXME
    """
    Test that ...   #FIXME
    """

    # Typical value 1
    actual_result =  _______________ #FIXME
    expected_result = ______________ #FIXME
    assert actual_result == expected_result

    # Typical value 2
    actual_result =  _______________ #FIXME
    expected_result = ______________ #FIXME
    assert actual_result == expected_result
    </code></pre>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a><span class="im">from</span> eva_data_analysis <span class="im">import</span> (</span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>    text_to_duration,</span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>    calculate_crew_size</span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>)</span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a><span class="kw">def</span> test_text_to_duration_integer():</span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a><span class="co">    Test that text_to_duration returns expected ground truth values</span></span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a><span class="co">    for typical whole hour durations</span></span>
<span id="cb29-11"><a href="#cb29-11" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb29-12"><a href="#cb29-12" tabindex="-1"></a>    actual_result <span class="op">=</span>  text_to_duration(<span class="st">"10:00"</span>)</span>
<span id="cb29-13"><a href="#cb29-13" tabindex="-1"></a>    expected_result <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb29-14"><a href="#cb29-14" tabindex="-1"></a>    <span class="cf">assert</span> actual_result <span class="op">==</span> expected_result</span>
<span id="cb29-15"><a href="#cb29-15" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" tabindex="-1"></a><span class="kw">def</span> test_text_to_duration_float():</span>
<span id="cb29-17"><a href="#cb29-17" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb29-18"><a href="#cb29-18" tabindex="-1"></a><span class="co">    Test that text_to_duration returns expected ground truth values</span></span>
<span id="cb29-19"><a href="#cb29-19" tabindex="-1"></a><span class="co">    for typical durations with a non-zero minute component</span></span>
<span id="cb29-20"><a href="#cb29-20" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb29-21"><a href="#cb29-21" tabindex="-1"></a>    actual_result <span class="op">=</span> text_to_duration(<span class="st">"10:20"</span>)</span>
<span id="cb29-22"><a href="#cb29-22" tabindex="-1"></a>    expected_result <span class="op">=</span> <span class="fl">10.33333333</span></span>
<span id="cb29-23"><a href="#cb29-23" tabindex="-1"></a>    <span class="cf">assert</span> actual_result <span class="op">==</span> pytest.approx(expected_result)</span>
<span id="cb29-24"><a href="#cb29-24" tabindex="-1"></a></span>
<span id="cb29-25"><a href="#cb29-25" tabindex="-1"></a><span class="kw">def</span> test_calculate_crew_size():</span>
<span id="cb29-26"><a href="#cb29-26" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb29-27"><a href="#cb29-27" tabindex="-1"></a><span class="co">    Test that calculate_crew_size returns expected ground truth values</span></span>
<span id="cb29-28"><a href="#cb29-28" tabindex="-1"></a><span class="co">    for typical crew values</span></span>
<span id="cb29-29"><a href="#cb29-29" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb29-30"><a href="#cb29-30" tabindex="-1"></a>    actual_result <span class="op">=</span> calculate_crew_size(<span class="st">"Valentina Tereshkova;"</span>)</span>
<span id="cb29-31"><a href="#cb29-31" tabindex="-1"></a>    expected_result <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb29-32"><a href="#cb29-32" tabindex="-1"></a>    <span class="cf">assert</span> actual_result <span class="op">==</span> expected_result</span>
<span id="cb29-33"><a href="#cb29-33" tabindex="-1"></a></span>
<span id="cb29-34"><a href="#cb29-34" tabindex="-1"></a>    actual_result <span class="op">=</span> calculate_crew_size(<span class="st">"Judith Resnik; Sally Ride;"</span>)</span>
<span id="cb29-35"><a href="#cb29-35" tabindex="-1"></a>    expected_result <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb29-36"><a href="#cb29-36" tabindex="-1"></a>    <span class="cf">assert</span> actual_result <span class="op">==</span> expected_result</span>
<span id="cb29-37"><a href="#cb29-37" tabindex="-1"></a></span>
<span id="cb29-38"><a href="#cb29-38" tabindex="-1"></a></span>
<span id="cb29-39"><a href="#cb29-39" tabindex="-1"></a><span class="co"># Edge cases</span></span>
<span id="cb29-40"><a href="#cb29-40" tabindex="-1"></a><span class="kw">def</span> test_calculate_crew_size_edge_cases():</span>
<span id="cb29-41"><a href="#cb29-41" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb29-42"><a href="#cb29-42" tabindex="-1"></a><span class="co">    Test that calculate_crew_size returns expected ground truth values</span></span>
<span id="cb29-43"><a href="#cb29-43" tabindex="-1"></a><span class="co">    for edge case where crew is an empty string</span></span>
<span id="cb29-44"><a href="#cb29-44" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb29-45"><a href="#cb29-45" tabindex="-1"></a>    actual_result <span class="op">=</span> calculate_crew_size(<span class="st">""</span>)</span>
<span id="cb29-46"><a href="#cb29-46" tabindex="-1"></a>    <span class="cf">assert</span> actual_result <span class="kw">is</span> <span class="va">None</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>========================================================== test session starts
platform darwin -- Python 3.12.3, pytest-8.2.2, pluggy-1.5.0
rootdir: /Users/AnnResearcher/Desktop/Spacewalks
plugins: cov-5.0.0
collected 4 items

tests/test_eva_data_analysis.py .F..                                                                                               [100%]

================================================================ FAILURES
______________________________________________________ test_text_to_duration_float

    def test_text_to_duration_float():
        """
        Test that text_to_duration returns expected ground truth values
        for typical durations with a non-zero minute component
        """
        actual_result = text_to_duration("10:20")
        expected_result = 10.33333333
&gt;       assert actual_result == pytest.approx(expected_result)
E       assert 13.333333333333334 == 10.33333333 ± 1.0e-05
E
E         comparison failed
E         Obtained: 13.333333333333334
E         Expected: 10.33333333 ± 1.0e-05

tests/test_eva_data_analysis.py:23: AssertionError
======================================================== short test summary info
FAILED tests/test_eva_data_analysis.py::test_text_to_duration_float - assert 13.333333333333334 == 10.33333333 ± 1.0e-05
====================================================== 1 failed, 3 passed in 0.33s </code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="parameterising-tests" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="parameterising-tests" class="callout-inner">
<h3 class="callout-title">Parameterising Tests</h3>
<div class="callout-content">
<p>If we revisit our test suite, we can see that some of our tests do
not follow the <a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself" class="external-link">“Don’t
Repeat Yourself principle”</a> which prevents software - including
testing code - from becoming overly long and confusing. For example, if
we examine our test for <code>calculate_crew_size</code>, we can see
that a small block of code is repeated twice with different input
values:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="kw">def</span> test_calculate_crew_size():</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a><span class="co">    Test that calculate_crew_size returns expected ground truth values</span></span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a><span class="co">    for typical crew values</span></span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a>    actual_result <span class="op">=</span> calculate_crew_size(<span class="st">"Valentina Tereshkova;"</span>)</span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a>    expected_result <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a>    <span class="cf">assert</span> actual_result <span class="op">==</span> expected_result</span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a>    actual_result <span class="op">=</span> calculate_crew_size(<span class="st">"Judith Resnik; Sally Ride;"</span>)</span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a>    expected_result <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a>    <span class="cf">assert</span> actual_result <span class="op">==</span> expected_result</span></code></pre>
</div>
<p>Where the repeated code block is:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>actual_result <span class="op">=</span> calculate_crew_size(input_value)</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>expected_result <span class="op">=</span> expected_value</span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a><span class="cf">assert</span> actual_result <span class="op">==</span> expected_result</span></code></pre>
</div>
<p>To avoid repeating ourselves, we can use an approach called test
parameterisation. This allows us to apply our test function to a list of
input / expected output pairs without the need for repetition. To
parameterise the <code>calculate_crew_size</code> test, we rewrite the
test function as follows:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a><span class="at">@pytest.mark.parametrize</span>(<span class="st">"input_value, expected_result"</span>, [</span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>    (<span class="st">"Valentina Tereshkova;"</span>, <span class="dv">1</span>),</span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a>    (<span class="st">"Judith Resnik; Sally Ride;"</span>, <span class="dv">2</span>),</span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a>])</span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a><span class="kw">def</span> test_calculate_crew_size(input_value, expected_result):</span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a><span class="co">    Test that calculate_crew_size returns expected ground truth values</span></span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a><span class="co">    for typical crew values</span></span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb33-12"><a href="#cb33-12" tabindex="-1"></a>    actual_result <span class="op">=</span> calculate_crew_size(input_value)</span>
<span id="cb33-13"><a href="#cb33-13" tabindex="-1"></a>    <span class="cf">assert</span> actual_result <span class="op">==</span> expected_result</span></code></pre>
</div>
<p>Notice the following key changes to our code:</p>
<ul><li><p>Our unparameterised test function did not have any arguments
(<code>test_calculate_crew_size()</code>) and our input / expected
values were all defined the body of our test function.</p></li>
<li><p>In the parameterised version, the body of our test function has
been rewritten as a parameterised block of code that uses the variables
<code>input_value</code> and <code>expected_result</code> which are now
arguments of the test function.</p></li>
<li><p>A python decorator <span class="citation">@pytest.mark.parametrize</span> is placed immediately
before the test function and indicates that it should be run once for
each set of parameters provided.</p></li>
</ul><p>In Python, a decorator is a function that can modify the behaviour of
another function. <span class="citation">@pytest.mark.parametrize</span>
is a decorator provided by pytest that modifies the behaviour of our
test function by running it multiple times - once for each set of
inputs. This decorator takes two main arguments:</p>
<ul><li><p>Parameter Names: A string with the names of the parameters that
the test function will accept, separated by commas – in this case
“input_value” and “expected_value”</p></li>
<li><p>Parameter Values: A list of tuples, where each tuple contains the
values for the parameters specified in the first argument.</p></li>
</ul><p>The final parameterised version of our test, is more manageable,
readable and easier to maintain!</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="enough-tests">Enough Tests<a class="anchor" aria-label="anchor" href="#enough-tests"></a></h3>
<p>In this episode, so far we’ve (only) written tests for two individual
functions <code>text_to_duration</code> and
<code>calculate_crew_size</code>.</p>
<p>We can quantify the proportion of our code base that is run (also
referred to as “exercised”) by a given test suite using a metric called
code coverage:</p>
<p><span class="math display">\[ \text{Line Coverage} = \left(
\frac{\text{Number of Executed Lines}}{\text{Total Number of Executable
Lines}} \right) \times 100 \]</span></p>
<p>We can calculate our test coverage using the pytest-cov library.
Before we do so, let’s fix our bug so that our output is cleaner and we
can focus on the code coverage information.</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="kw">def</span> text_to_duration(duration):</span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a><span class="co">    Convert a text format duration "HH:MM" to duration in hours</span></span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb34-6"><a href="#cb34-6" tabindex="-1"></a><span class="co">        duration (str): The text format duration</span></span>
<span id="cb34-7"><a href="#cb34-7" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb34-9"><a href="#cb34-9" tabindex="-1"></a><span class="co">        duration (float): The duration in hours</span></span>
<span id="cb34-10"><a href="#cb34-10" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb34-11"><a href="#cb34-11" tabindex="-1"></a>    hours, minutes <span class="op">=</span> duration.split(<span class="st">":"</span>)</span>
<span id="cb34-12"><a href="#cb34-12" tabindex="-1"></a>    duration_hours <span class="op">=</span> <span class="bu">int</span>(hours) <span class="op">+</span> <span class="bu">int</span>(minutes)<span class="op">/</span><span class="dv">60</span> <span class="co"># Bug-free line</span></span>
<span id="cb34-13"><a href="#cb34-13" tabindex="-1"></a>    <span class="cf">return</span> duration_hours</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> python <span class="at">-m</span> pytest <span class="at">--cov</span> </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>========================================================== test session starts
platform darwin -- Python 3.12.3, pytest-8.2.2, pluggy-1.5.0
rootdir: /Users/AnnResearcher/Desktop/Spacewalks
plugins: cov-5.0.0
collected 4 items

tests/test_eva_data_analysis.py ....                                                                                               [100%]

---------- coverage: platform darwin, python 3.12.3-final-0 ----------
Name                              Stmts   Miss  Cover
-----------------------------------------------------
eva_data_analysis.py                 56     38    32%
tests/test_eva_data_analysis.py      20      0   100%
-----------------------------------------------------
TOTAL                                76     38    50%


=========================================================== 4 passed in 1.04s</code></pre>
</div>
<p>To get an in-depth report about which parts of our code are tested
and which are not, we can add the option
<code>--cov-report=html</code>.</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> python <span class="at">-m</span> pytest <span class="at">--cov</span> <span class="at">--cov-report</span><span class="op">=</span>html </span></code></pre>
</div>
<p>This option generates a folder <code>htmlcov</code> which contains a
html code coverage report. This provides structured information about
our test coverage including (a) a table showing the proportion of lines
in each function that are currently tested (b) an annotated copy of our
code where untested lines are highlighted in red.</p>
<p>Ideally, all the lines of code in our code base should be exercised
by at least one test. However, if we lack the time and resources to test
every line of our code we should:</p>
<ul><li>Avoid testing Python’s built-in functions or functions imported from
well-known and well-test libraries like Pandas or numpy.</li>
<li>Focus on the the parts of our code that carry the greatest
“reputational risk” i.e. that could affect the accuracy of our reported
results.</li>
</ul><p>One the other hand, it is also important to realise that althought
coverage of less than 100% indicates that more testing may be helpful,
test coverage of 100% does not mean that our code is bug-free!</p>
<div id="evaluating-code-coverage" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="evaluating-code-coverage" class="callout-inner">
<h3 class="callout-title">Evaluating Code Coverage</h3>
<div class="callout-content">
<p>Generate a code coverage report for the <code>Spacewalks</code> test
suite and extract the following information:</p>
<ol style="list-style-type: lower-alpha"><li>What proportion of the code base is currently NOT exercised by the
test suite?</li>
<li>Which functions in our code base are currently untested?</li>
</ol></div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> python <span class="at">-m</span> pytest <span class="at">--cov</span> <span class="at">--cov-report</span><span class="op">=</span>html</span></code></pre>
</div>
<ol style="list-style-type: lower-alpha"><li>The proportion of the code base NOT covered by our tests is
<code>100 - 32%</code> = 68%</li>
<li>The following functions in our code base are currently untested:
<ul><li>read_json_to_dataframe</li>
<li>write_dataframe_to_csv</li>
<li>add_duration_hours_variable</li>
<li>plot_cumulative_time_in_space</li>
<li>add_crew_size_variable</li>
</ul></li>
</ol></div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="implementing-a-minimal-test-suite">Implementing a minimal test suite<a class="anchor" aria-label="anchor" href="#implementing-a-minimal-test-suite"></a></h3>
<p>A member of our research team shares the following code with us to
add to the Spacewalks codebase:</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="kw">def</span> summarise_categorical(df_, varname_):</span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a><span class="co">    Tabulate the distribution of a categorical variable</span></span>
<span id="cb39-4"><a href="#cb39-4" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb39-6"><a href="#cb39-6" tabindex="-1"></a><span class="co">        df_ (pd.DataFrame): The input dataframe.</span></span>
<span id="cb39-7"><a href="#cb39-7" tabindex="-1"></a><span class="co">        varname_ (str): The name of the variable</span></span>
<span id="cb39-8"><a href="#cb39-8" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb39-10"><a href="#cb39-10" tabindex="-1"></a><span class="co">        pd.DataFrame: dataframe containing the count and percentage of</span></span>
<span id="cb39-11"><a href="#cb39-11" tabindex="-1"></a><span class="co">        each unique value of varname_</span></span>
<span id="cb39-12"><a href="#cb39-12" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb39-13"><a href="#cb39-13" tabindex="-1"></a><span class="co">    Examples:</span></span>
<span id="cb39-14"><a href="#cb39-14" tabindex="-1"></a><span class="co">        &gt;&gt;&gt; df_example  = pd.DataFrame({</span></span>
<span id="cb39-15"><a href="#cb39-15" tabindex="-1"></a><span class="co">            'vehicle': ['Apollo 16', 'Apollo 17', 'Apollo 17'],</span></span>
<span id="cb39-16"><a href="#cb39-16" tabindex="-1"></a><span class="co">            }, index=[0, 1, 2)</span></span>
<span id="cb39-17"><a href="#cb39-17" tabindex="-1"></a><span class="co">        &gt;&gt;&gt; summarise_categorical(df_example, "vehicle")</span></span>
<span id="cb39-18"><a href="#cb39-18" tabindex="-1"></a><span class="co">        Tabulating distribution of categorical variable vehicle</span></span>
<span id="cb39-19"><a href="#cb39-19" tabindex="-1"></a><span class="co">             vehicle  count  percentage</span></span>
<span id="cb39-20"><a href="#cb39-20" tabindex="-1"></a><span class="co">        0  Apollo 16      1        33.0</span></span>
<span id="cb39-21"><a href="#cb39-21" tabindex="-1"></a><span class="co">        1  Apollo 17      2        67.0</span></span>
<span id="cb39-22"><a href="#cb39-22" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb39-23"><a href="#cb39-23" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Tabulating distribution of categorical variable </span><span class="sc">{</span>varname_<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb39-24"><a href="#cb39-24" tabindex="-1"></a></span>
<span id="cb39-25"><a href="#cb39-25" tabindex="-1"></a>    <span class="co"># Prepare statistical summary</span></span>
<span id="cb39-26"><a href="#cb39-26" tabindex="-1"></a>    count_variable <span class="op">=</span> df_[[varname_]].copy()</span>
<span id="cb39-27"><a href="#cb39-27" tabindex="-1"></a>    count_summary <span class="op">=</span> count_variable.value_counts()</span>
<span id="cb39-28"><a href="#cb39-28" tabindex="-1"></a>    percentage_summary <span class="op">=</span> <span class="bu">round</span>(count_summary <span class="op">/</span> count_variable.size, <span class="dv">2</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb39-29"><a href="#cb39-29" tabindex="-1"></a></span>
<span id="cb39-30"><a href="#cb39-30" tabindex="-1"></a>    <span class="co"># Combine results into a summary data frame</span></span>
<span id="cb39-31"><a href="#cb39-31" tabindex="-1"></a>    df_summary <span class="op">=</span> pd.concat([count_summary, percentage_summary], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb39-32"><a href="#cb39-32" tabindex="-1"></a>    df_summary.columns <span class="op">=</span> [<span class="st">'count'</span>, <span class="st">'percentage'</span>]</span>
<span id="cb39-33"><a href="#cb39-33" tabindex="-1"></a>    df_summary.sort_index(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb39-34"><a href="#cb39-34" tabindex="-1"></a></span>
<span id="cb39-35"><a href="#cb39-35" tabindex="-1"></a></span>
<span id="cb39-36"><a href="#cb39-36" tabindex="-1"></a>    df_summary <span class="op">=</span> df_summary.reset_index()</span>
<span id="cb39-37"><a href="#cb39-37" tabindex="-1"></a>    <span class="cf">return</span> df_summary</span></code></pre>
</div>
<p>This looks like a useful tool for creating summary statistics tables,
so let’s integrate this into our <code>eva_data_analysis.py</code>code
and then write a minimal test suite to check that this code is behaving
as expected.</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb40-4"><a href="#cb40-4" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb40-5"><a href="#cb40-5" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" tabindex="-1"></a>...</span>
<span id="cb40-8"><a href="#cb40-8" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" tabindex="-1"></a><span class="kw">def</span> add_crew_size_variable(df_):</span>
<span id="cb40-10"><a href="#cb40-10" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb40-11"><a href="#cb40-11" tabindex="-1"></a><span class="co">    Add crew size (crew_size) variable to the dataset</span></span>
<span id="cb40-12"><a href="#cb40-12" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb40-14"><a href="#cb40-14" tabindex="-1"></a><span class="co">        df_ (pd.DataFrame): The input dataframe.</span></span>
<span id="cb40-15"><a href="#cb40-15" tabindex="-1"></a></span>
<span id="cb40-16"><a href="#cb40-16" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb40-17"><a href="#cb40-17" tabindex="-1"></a><span class="co">        pd.DataFrame: A copy of df_ with the new crew_size variable added</span></span>
<span id="cb40-18"><a href="#cb40-18" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb40-19"><a href="#cb40-19" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Adding crew size variable (crew_size) to dataset'</span>)</span>
<span id="cb40-20"><a href="#cb40-20" tabindex="-1"></a>    df_copy <span class="op">=</span> df_.copy()</span>
<span id="cb40-21"><a href="#cb40-21" tabindex="-1"></a>    df_copy[<span class="st">"crew_size"</span>] <span class="op">=</span> df_copy[<span class="st">"crew"</span>].<span class="bu">apply</span>(</span>
<span id="cb40-22"><a href="#cb40-22" tabindex="-1"></a>        calculate_crew_size</span>
<span id="cb40-23"><a href="#cb40-23" tabindex="-1"></a>    )</span>
<span id="cb40-24"><a href="#cb40-24" tabindex="-1"></a>    <span class="cf">return</span> df_copy</span>
<span id="cb40-25"><a href="#cb40-25" tabindex="-1"></a></span>
<span id="cb40-26"><a href="#cb40-26" tabindex="-1"></a></span>
<span id="cb40-27"><a href="#cb40-27" tabindex="-1"></a><span class="kw">def</span> summarise_categorical(df_, varname_):</span>
<span id="cb40-28"><a href="#cb40-28" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb40-29"><a href="#cb40-29" tabindex="-1"></a><span class="co">    Tabulate the distribution of a categorical variable</span></span>
<span id="cb40-30"><a href="#cb40-30" tabindex="-1"></a></span>
<span id="cb40-31"><a href="#cb40-31" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb40-32"><a href="#cb40-32" tabindex="-1"></a><span class="co">        df_ (pd.DataFrame): The input dataframe.</span></span>
<span id="cb40-33"><a href="#cb40-33" tabindex="-1"></a><span class="co">        varname_ (str): The name of the variable</span></span>
<span id="cb40-34"><a href="#cb40-34" tabindex="-1"></a></span>
<span id="cb40-35"><a href="#cb40-35" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb40-36"><a href="#cb40-36" tabindex="-1"></a><span class="co">        pd.DataFrame: dataframe containing the count and percentage of</span></span>
<span id="cb40-37"><a href="#cb40-37" tabindex="-1"></a><span class="co">        each unique value of varname_</span></span>
<span id="cb40-38"><a href="#cb40-38" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb40-39"><a href="#cb40-39" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Tabulating distribution of categorical variable </span><span class="sc">{</span>varname_<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb40-40"><a href="#cb40-40" tabindex="-1"></a></span>
<span id="cb40-41"><a href="#cb40-41" tabindex="-1"></a>    <span class="co"># Prepare statistical summary</span></span>
<span id="cb40-42"><a href="#cb40-42" tabindex="-1"></a>    count_variable <span class="op">=</span> df_[[varname_]].copy()</span>
<span id="cb40-43"><a href="#cb40-43" tabindex="-1"></a>    count_summary <span class="op">=</span> count_variable.value_counts() <span class="co"># There is a bug here that we will fix later!</span></span>
<span id="cb40-44"><a href="#cb40-44" tabindex="-1"></a>    percentage_summary <span class="op">=</span> <span class="bu">round</span>(count_summary <span class="op">/</span> count_variable.size, <span class="dv">2</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb40-45"><a href="#cb40-45" tabindex="-1"></a></span>
<span id="cb40-46"><a href="#cb40-46" tabindex="-1"></a>    <span class="co"># Combine results into a summary data frame</span></span>
<span id="cb40-47"><a href="#cb40-47" tabindex="-1"></a>    df_summary <span class="op">=</span> pd.concat([count_summary, percentage_summary], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb40-48"><a href="#cb40-48" tabindex="-1"></a>    df_summary.columns <span class="op">=</span> [<span class="st">'count'</span>, <span class="st">'percentage'</span>]</span>
<span id="cb40-49"><a href="#cb40-49" tabindex="-1"></a>    df_summary.sort_index(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb40-50"><a href="#cb40-50" tabindex="-1"></a></span>
<span id="cb40-51"><a href="#cb40-51" tabindex="-1"></a></span>
<span id="cb40-52"><a href="#cb40-52" tabindex="-1"></a>    df_summary <span class="op">=</span> df_summary.reset_index()</span>
<span id="cb40-53"><a href="#cb40-53" tabindex="-1"></a>    <span class="cf">return</span> df_summary</span>
<span id="cb40-54"><a href="#cb40-54" tabindex="-1"></a></span>
<span id="cb40-55"><a href="#cb40-55" tabindex="-1"></a></span>
<span id="cb40-56"><a href="#cb40-56" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb40-57"><a href="#cb40-57" tabindex="-1"></a></span>
<span id="cb40-58"><a href="#cb40-58" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(sys.argv) <span class="op">&lt;</span> <span class="dv">3</span>:</span>
<span id="cb40-59"><a href="#cb40-59" tabindex="-1"></a>        input_file <span class="op">=</span> <span class="st">'./eva-data.json'</span></span>
<span id="cb40-60"><a href="#cb40-60" tabindex="-1"></a>        output_file <span class="op">=</span> <span class="st">'./eva-data.csv'</span></span>
<span id="cb40-61"><a href="#cb40-61" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Using default input and output filenames'</span>)</span>
<span id="cb40-62"><a href="#cb40-62" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb40-63"><a href="#cb40-63" tabindex="-1"></a>        input_file <span class="op">=</span> sys.argv[<span class="dv">1</span>]</span>
<span id="cb40-64"><a href="#cb40-64" tabindex="-1"></a>        output_file <span class="op">=</span> sys.argv[<span class="dv">2</span>]</span>
<span id="cb40-65"><a href="#cb40-65" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'Using custom input and output filenames'</span>)</span>
<span id="cb40-66"><a href="#cb40-66" tabindex="-1"></a></span>
<span id="cb40-67"><a href="#cb40-67" tabindex="-1"></a>    graph_file <span class="op">=</span> <span class="st">'./cumulative_eva_graph.png'</span></span>
<span id="cb40-68"><a href="#cb40-68" tabindex="-1"></a></span>
<span id="cb40-69"><a href="#cb40-69" tabindex="-1"></a>    eva_data <span class="op">=</span> read_json_to_dataframe(input_file)</span>
<span id="cb40-70"><a href="#cb40-70" tabindex="-1"></a></span>
<span id="cb40-71"><a href="#cb40-71" tabindex="-1"></a>    eva_data_prepared <span class="op">=</span> add_crew_size_variable(eva_data)</span>
<span id="cb40-72"><a href="#cb40-72" tabindex="-1"></a></span>
<span id="cb40-73"><a href="#cb40-73" tabindex="-1"></a>    write_dataframe_to_csv(eva_data_prepared, output_file)</span>
<span id="cb40-74"><a href="#cb40-74" tabindex="-1"></a></span>
<span id="cb40-75"><a href="#cb40-75" tabindex="-1"></a>    table_crew_size <span class="op">=</span> summarise_categorical(eva_data_prepared, <span class="st">"crew_size"</span>)</span>
<span id="cb40-76"><a href="#cb40-76" tabindex="-1"></a></span>
<span id="cb40-77"><a href="#cb40-77" tabindex="-1"></a>    write_dataframe_to_csv(table_crew_size, <span class="st">"./table_crew_size.csv"</span>)</span>
<span id="cb40-78"><a href="#cb40-78" tabindex="-1"></a></span>
<span id="cb40-79"><a href="#cb40-79" tabindex="-1"></a>    plot_cumulative_time_in_space(eva_data_prepared, graph_file)</span>
<span id="cb40-80"><a href="#cb40-80" tabindex="-1"></a></span>
<span id="cb40-81"><a href="#cb40-81" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"--END--"</span>)</span></code></pre>
</div>
<p>To write tests for this function, we’ll need to be able to compare
dataframes. The pandas.testing module in the pandas library provides
functions and utilities for testing pandas objects and includes a
function <code>assert_frame_equal</code> that we can use to compare two
dataframes.</p>
<div id="exercise-1---typical-inputs" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-1---typical-inputs" class="callout-inner">
<h3 class="callout-title">Exercise 1 - Typical Inputs</h3>
<div class="callout-content">
<p>First, check that the function behaves as expected with typical input
values. Fill in the gaps in the skeleton test below:</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="im">import</span> pandas.testing <span class="im">as</span> pdt</span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a><span class="kw">def</span> test_summarise_categorical_typical():</span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb41-5"><a href="#cb41-5" tabindex="-1"></a><span class="co">    Test that summarise_categorical correctly tabulates</span></span>
<span id="cb41-6"><a href="#cb41-6" tabindex="-1"></a><span class="co">    distribution of values (counts, percentages) for a ground truth</span></span>
<span id="cb41-7"><a href="#cb41-7" tabindex="-1"></a><span class="co">    example (typical values)</span></span>
<span id="cb41-8"><a href="#cb41-8" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb41-9"><a href="#cb41-9" tabindex="-1"></a>    test_input <span class="op">=</span> pd.DataFrame({</span>
<span id="cb41-10"><a href="#cb41-10" tabindex="-1"></a>        <span class="st">'country'</span>: _________________________________________, <span class="co"># FIX-ME</span></span>
<span id="cb41-11"><a href="#cb41-11" tabindex="-1"></a>    }, index<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb41-12"><a href="#cb41-12" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" tabindex="-1"></a>    expected_result <span class="op">=</span> pd.DataFrame({</span>
<span id="cb41-14"><a href="#cb41-14" tabindex="-1"></a>        <span class="st">'country'</span>: [<span class="st">"Russia"</span>, <span class="st">"USA"</span>],</span>
<span id="cb41-15"><a href="#cb41-15" tabindex="-1"></a>        <span class="st">'count'</span>: [<span class="dv">2</span>, <span class="dv">3</span>],</span>
<span id="cb41-16"><a href="#cb41-16" tabindex="-1"></a>        <span class="st">'percentage'</span>: [<span class="fl">40.0</span>, <span class="fl">60.0</span>],</span>
<span id="cb41-17"><a href="#cb41-17" tabindex="-1"></a>    }, index<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb41-18"><a href="#cb41-18" tabindex="-1"></a></span>
<span id="cb41-19"><a href="#cb41-19" tabindex="-1"></a>    actual_result <span class="op">=</span> ____________________________________________ <span class="co"># FIX-ME </span></span>
<span id="cb41-20"><a href="#cb41-20" tabindex="-1"></a>    </span>
<span id="cb41-21"><a href="#cb41-21" tabindex="-1"></a>    pdt.__________________(actual_result, _______________) <span class="co">#FIX-ME</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="im">import</span> pandas.testing <span class="im">as</span> pdt</span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a><span class="kw">def</span> test_summarise_categorical():</span>
<span id="cb42-4"><a href="#cb42-4" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb42-5"><a href="#cb42-5" tabindex="-1"></a><span class="co">    Test that summarise_categorical correctly tabulates</span></span>
<span id="cb42-6"><a href="#cb42-6" tabindex="-1"></a><span class="co">    distribution of values (counts, percentages) for a simple ground truth</span></span>
<span id="cb42-7"><a href="#cb42-7" tabindex="-1"></a><span class="co">    example</span></span>
<span id="cb42-8"><a href="#cb42-8" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb42-9"><a href="#cb42-9" tabindex="-1"></a>    test_input <span class="op">=</span> pd.DataFrame({</span>
<span id="cb42-10"><a href="#cb42-10" tabindex="-1"></a>        <span class="st">'country'</span>: [<span class="st">'USA'</span>, <span class="st">'USA'</span>, <span class="st">'USA'</span>, <span class="st">"Russia"</span>, <span class="st">"Russia"</span>],</span>
<span id="cb42-11"><a href="#cb42-11" tabindex="-1"></a>    }, index<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb42-12"><a href="#cb42-12" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" tabindex="-1"></a>    expected_result <span class="op">=</span> pd.DataFrame({</span>
<span id="cb42-14"><a href="#cb42-14" tabindex="-1"></a>        <span class="st">'country'</span>: [<span class="st">"Russia"</span>, <span class="st">"USA"</span>],</span>
<span id="cb42-15"><a href="#cb42-15" tabindex="-1"></a>        <span class="st">'count'</span>: [<span class="dv">2</span>, <span class="dv">3</span>],</span>
<span id="cb42-16"><a href="#cb42-16" tabindex="-1"></a>        <span class="st">'percentage'</span>: [<span class="fl">40.0</span>, <span class="fl">60.0</span>],</span>
<span id="cb42-17"><a href="#cb42-17" tabindex="-1"></a>    }, index<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb42-18"><a href="#cb42-18" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" tabindex="-1"></a>    actual_result <span class="op">=</span> summarise_categorical(test_input, <span class="st">"country"</span>)</span>
<span id="cb42-20"><a href="#cb42-20" tabindex="-1"></a></span>
<span id="cb42-21"><a href="#cb42-21" tabindex="-1"></a>    pdt.assert_frame_equal(actual_result, expected_result)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="exercise-2---edge-cases" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-2---edge-cases" class="callout-inner">
<h3 class="callout-title">Exercise 2 - Edge Cases</h3>
<div class="callout-content">
<p>Now let’s check that the function behaves as expected with edge
cases.<br>
Does the code behave as expected when the column of interest contains
one or more missing values (pd.NA)? (write a new test).</p>
<p>Fill in the gaps in the skeleton test below:</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="im">import</span> pandas.testing <span class="im">as</span> pdt</span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" tabindex="-1"></a><span class="kw">def</span> test_summarise_categorical_missvals():</span>
<span id="cb43-4"><a href="#cb43-4" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb43-5"><a href="#cb43-5" tabindex="-1"></a><span class="co">    Test that summarise_categorical correctly tabulates</span></span>
<span id="cb43-6"><a href="#cb43-6" tabindex="-1"></a><span class="co">    distribution of values (counts, percentages) for a ground truth</span></span>
<span id="cb43-7"><a href="#cb43-7" tabindex="-1"></a><span class="co">    example (edge case where all column contains missing values)</span></span>
<span id="cb43-8"><a href="#cb43-8" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb43-9"><a href="#cb43-9" tabindex="-1"></a>    test_input <span class="op">=</span> _______________</span>
<span id="cb43-10"><a href="#cb43-10" tabindex="-1"></a>    _______________</span>
<span id="cb43-11"><a href="#cb43-11" tabindex="-1"></a>    _______________ <span class="co"># FIX-ME</span></span>
<span id="cb43-12"><a href="#cb43-12" tabindex="-1"></a>    </span>
<span id="cb43-13"><a href="#cb43-13" tabindex="-1"></a>    expected_result <span class="op">=</span> _______________</span>
<span id="cb43-14"><a href="#cb43-14" tabindex="-1"></a>    _______________</span>
<span id="cb43-15"><a href="#cb43-15" tabindex="-1"></a>    _______________ <span class="co"># FIX-ME</span></span>
<span id="cb43-16"><a href="#cb43-16" tabindex="-1"></a>    </span>
<span id="cb43-17"><a href="#cb43-17" tabindex="-1"></a>    actual_result <span class="op">=</span> summarise_categorical(test_input, <span class="st">"country"</span>)</span>
<span id="cb43-18"><a href="#cb43-18" tabindex="-1"></a></span>
<span id="cb43-19"><a href="#cb43-19" tabindex="-1"></a>    pdt.assert_frame_equal(actual_result, expected_result)</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6"> Show me the solution </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" aria-labelledby="headingSolution6" data-bs-parent="#accordionSolution6">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="im">import</span> pandas.testing <span class="im">as</span> pdt</span>
<span id="cb44-2"><a href="#cb44-2" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" tabindex="-1"></a><span class="kw">def</span> test_summarise_categorical_missvals():</span>
<span id="cb44-4"><a href="#cb44-4" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb44-5"><a href="#cb44-5" tabindex="-1"></a><span class="co">    Test that summarise_categorical correctly tabulates</span></span>
<span id="cb44-6"><a href="#cb44-6" tabindex="-1"></a><span class="co">    distribution of values (counts, percentages) for a ground truth</span></span>
<span id="cb44-7"><a href="#cb44-7" tabindex="-1"></a><span class="co">    example (edge case where column contains missing values)</span></span>
<span id="cb44-8"><a href="#cb44-8" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb44-9"><a href="#cb44-9" tabindex="-1"></a>    test_input <span class="op">=</span> pd.DataFrame({</span>
<span id="cb44-10"><a href="#cb44-10" tabindex="-1"></a>        <span class="st">'country'</span>: [<span class="st">'USA'</span>, <span class="st">'USA'</span>, <span class="st">'USA'</span>, <span class="st">"Russia"</span>, pd.NA],</span>
<span id="cb44-11"><a href="#cb44-11" tabindex="-1"></a>    }, index<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb44-12"><a href="#cb44-12" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" tabindex="-1"></a>    expected_result <span class="op">=</span> pd.DataFrame({</span>
<span id="cb44-14"><a href="#cb44-14" tabindex="-1"></a>        <span class="st">'country'</span>: [<span class="st">"Russia"</span>, <span class="st">"USA"</span>, np.nan], <span class="co"># np.nan because pd.NA is cast to np.nan</span></span>
<span id="cb44-15"><a href="#cb44-15" tabindex="-1"></a>        <span class="st">'count'</span>: [<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>],</span>
<span id="cb44-16"><a href="#cb44-16" tabindex="-1"></a>        <span class="st">'percentage'</span>: [<span class="fl">20.0</span>, <span class="fl">60.0</span>, <span class="fl">20.0</span>],</span>
<span id="cb44-17"><a href="#cb44-17" tabindex="-1"></a>    }, index<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb44-18"><a href="#cb44-18" tabindex="-1"></a>    actual_result <span class="op">=</span> summarise_categorical(test_input, <span class="st">"country"</span>)</span>
<span id="cb44-19"><a href="#cb44-19" tabindex="-1"></a></span>
<span id="cb44-20"><a href="#cb44-20" tabindex="-1"></a>    pdt.assert_frame_equal(actual_result, expected_result)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="exercise-3---invalid-inputs" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="exercise-3---invalid-inputs" class="callout-inner">
<h3 class="callout-title">Exercise 3 - Invalid inputs</h3>
<div class="callout-content">
<p>Now write a test to check that the <code>summarise_categorical</code>
function raises an appropriate error when asked to tabulate a column
that does not exist in the data frame.</p>
<p>Hint: lookup <code>pytest.raises</code> in the pytest
documentation.</p>
</div>
</div>
</div>
<div id="accordionSolution7" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution7" aria-expanded="false" aria-controls="collapseSolution7">
  <h4 class="accordion-header" id="headingSolution7"> Show me the solution </h4>
</button>
<div id="collapseSolution7" class="accordion-collapse collapse" aria-labelledby="headingSolution7" data-bs-parent="#accordionSolution7">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a></span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a><span class="kw">def</span> test_summarise_categorical_invalid():</span>
<span id="cb45-3"><a href="#cb45-3" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb45-4"><a href="#cb45-4" tabindex="-1"></a><span class="co">    Test that summarise_categorical raises an</span></span>
<span id="cb45-5"><a href="#cb45-5" tabindex="-1"></a><span class="co">    error when a non-existent column is input</span></span>
<span id="cb45-6"><a href="#cb45-6" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb45-7"><a href="#cb45-7" tabindex="-1"></a>    test_input <span class="op">=</span> pd.DataFrame({</span>
<span id="cb45-8"><a href="#cb45-8" tabindex="-1"></a>        <span class="st">'country'</span>: [<span class="st">'USA'</span>, <span class="st">'USA'</span>, <span class="st">'USA'</span>, <span class="st">"Russia"</span>, <span class="st">"Russia"</span>],</span>
<span id="cb45-9"><a href="#cb45-9" tabindex="-1"></a>    }, index<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb45-10"><a href="#cb45-10" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" tabindex="-1"></a>    <span class="cf">with</span> pytest.raises(<span class="pp">KeyError</span>):</span>
<span id="cb45-12"><a href="#cb45-12" tabindex="-1"></a>        summarise_categorical(test_input, <span class="st">"vehicle"</span>)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="improving-our-code">Improving Our Code<a class="anchor" aria-label="anchor" href="#improving-our-code"></a></h2>
<hr class="half-width"><p>At the end of this episode, our test suite in <code>tests</code>
should look like this:</p>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb46-2"><a href="#cb46-2" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb46-3"><a href="#cb46-3" tabindex="-1"></a><span class="im">import</span> pandas.testing <span class="im">as</span> pdt</span>
<span id="cb46-4"><a href="#cb46-4" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb46-5"><a href="#cb46-5" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" tabindex="-1"></a><span class="im">from</span> eva_data_analysis <span class="im">import</span> (</span>
<span id="cb46-7"><a href="#cb46-7" tabindex="-1"></a>    text_to_duration,</span>
<span id="cb46-8"><a href="#cb46-8" tabindex="-1"></a>    calculate_crew_size,</span>
<span id="cb46-9"><a href="#cb46-9" tabindex="-1"></a>    summarise_categorical</span>
<span id="cb46-10"><a href="#cb46-10" tabindex="-1"></a>)</span>
<span id="cb46-11"><a href="#cb46-11" tabindex="-1"></a></span>
<span id="cb46-12"><a href="#cb46-12" tabindex="-1"></a><span class="kw">def</span> test_text_to_duration_integer():</span>
<span id="cb46-13"><a href="#cb46-13" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb46-14"><a href="#cb46-14" tabindex="-1"></a><span class="co">    Test that text_to_duration returns expected ground truth values</span></span>
<span id="cb46-15"><a href="#cb46-15" tabindex="-1"></a><span class="co">    for typical whole hour durations</span></span>
<span id="cb46-16"><a href="#cb46-16" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb46-17"><a href="#cb46-17" tabindex="-1"></a>    actual_result <span class="op">=</span>  text_to_duration(<span class="st">"10:00"</span>)</span>
<span id="cb46-18"><a href="#cb46-18" tabindex="-1"></a>    expected_result <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb46-19"><a href="#cb46-19" tabindex="-1"></a>    <span class="cf">assert</span> actual_result <span class="op">==</span> expected_result</span>
<span id="cb46-20"><a href="#cb46-20" tabindex="-1"></a></span>
<span id="cb46-21"><a href="#cb46-21" tabindex="-1"></a><span class="kw">def</span> test_text_to_duration_float():</span>
<span id="cb46-22"><a href="#cb46-22" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb46-23"><a href="#cb46-23" tabindex="-1"></a><span class="co">    Test that text_to_duration returns expected ground truth values</span></span>
<span id="cb46-24"><a href="#cb46-24" tabindex="-1"></a><span class="co">    for typical durations with a non-zero minute component</span></span>
<span id="cb46-25"><a href="#cb46-25" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb46-26"><a href="#cb46-26" tabindex="-1"></a>    actual_result <span class="op">=</span> text_to_duration(<span class="st">"10:20"</span>)</span>
<span id="cb46-27"><a href="#cb46-27" tabindex="-1"></a>    expected_result <span class="op">=</span> <span class="fl">10.33333333</span></span>
<span id="cb46-28"><a href="#cb46-28" tabindex="-1"></a>    <span class="cf">assert</span> actual_result <span class="op">==</span> pytest.approx(expected_result)</span>
<span id="cb46-29"><a href="#cb46-29" tabindex="-1"></a></span>
<span id="cb46-30"><a href="#cb46-30" tabindex="-1"></a><span class="kw">def</span> test_calculate_crew_size():</span>
<span id="cb46-31"><a href="#cb46-31" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb46-32"><a href="#cb46-32" tabindex="-1"></a><span class="co">    Test that calculate_crew_size returns expected ground truth values</span></span>
<span id="cb46-33"><a href="#cb46-33" tabindex="-1"></a><span class="co">    for typical crew values</span></span>
<span id="cb46-34"><a href="#cb46-34" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb46-35"><a href="#cb46-35" tabindex="-1"></a>    actual_result <span class="op">=</span> calculate_crew_size(<span class="st">"Valentina Tereshkova;"</span>)</span>
<span id="cb46-36"><a href="#cb46-36" tabindex="-1"></a>    expected_result <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb46-37"><a href="#cb46-37" tabindex="-1"></a>    <span class="cf">assert</span> actual_result <span class="op">==</span> expected_result</span>
<span id="cb46-38"><a href="#cb46-38" tabindex="-1"></a></span>
<span id="cb46-39"><a href="#cb46-39" tabindex="-1"></a>    actual_result <span class="op">=</span> calculate_crew_size(<span class="st">"Judith Resnik; Sally Ride;"</span>)</span>
<span id="cb46-40"><a href="#cb46-40" tabindex="-1"></a>    expected_result <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb46-41"><a href="#cb46-41" tabindex="-1"></a>    <span class="cf">assert</span> actual_result <span class="op">==</span> expected_result</span>
<span id="cb46-42"><a href="#cb46-42" tabindex="-1"></a></span>
<span id="cb46-43"><a href="#cb46-43" tabindex="-1"></a></span>
<span id="cb46-44"><a href="#cb46-44" tabindex="-1"></a><span class="kw">def</span> test_calculate_crew_size_edge_cases():</span>
<span id="cb46-45"><a href="#cb46-45" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb46-46"><a href="#cb46-46" tabindex="-1"></a><span class="co">    Test that calculate_crew_size returns expected ground truth values</span></span>
<span id="cb46-47"><a href="#cb46-47" tabindex="-1"></a><span class="co">    for edge case where crew is an empty string</span></span>
<span id="cb46-48"><a href="#cb46-48" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb46-49"><a href="#cb46-49" tabindex="-1"></a>    actual_result <span class="op">=</span> calculate_crew_size(<span class="st">""</span>)</span>
<span id="cb46-50"><a href="#cb46-50" tabindex="-1"></a>    <span class="cf">assert</span> actual_result <span class="kw">is</span> <span class="va">None</span></span>
<span id="cb46-51"><a href="#cb46-51" tabindex="-1"></a></span>
<span id="cb46-52"><a href="#cb46-52" tabindex="-1"></a></span>
<span id="cb46-53"><a href="#cb46-53" tabindex="-1"></a><span class="kw">def</span> test_summarise_categorical():</span>
<span id="cb46-54"><a href="#cb46-54" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb46-55"><a href="#cb46-55" tabindex="-1"></a><span class="co">    Test that summarise_categorical correctly tabulates</span></span>
<span id="cb46-56"><a href="#cb46-56" tabindex="-1"></a><span class="co">    distribution of values (counts, percentages) for a simple ground truth</span></span>
<span id="cb46-57"><a href="#cb46-57" tabindex="-1"></a><span class="co">    example</span></span>
<span id="cb46-58"><a href="#cb46-58" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb46-59"><a href="#cb46-59" tabindex="-1"></a>    test_input <span class="op">=</span> pd.DataFrame({</span>
<span id="cb46-60"><a href="#cb46-60" tabindex="-1"></a>        <span class="st">'country'</span>: [<span class="st">'USA'</span>, <span class="st">'USA'</span>, <span class="st">'USA'</span>, <span class="st">"Russia"</span>, <span class="st">"Russia"</span>],</span>
<span id="cb46-61"><a href="#cb46-61" tabindex="-1"></a>    }, index<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb46-62"><a href="#cb46-62" tabindex="-1"></a></span>
<span id="cb46-63"><a href="#cb46-63" tabindex="-1"></a>    expected_result <span class="op">=</span> pd.DataFrame({</span>
<span id="cb46-64"><a href="#cb46-64" tabindex="-1"></a>        <span class="st">'country'</span>: [<span class="st">"Russia"</span>, <span class="st">"USA"</span>],</span>
<span id="cb46-65"><a href="#cb46-65" tabindex="-1"></a>        <span class="st">'count'</span>: [<span class="dv">2</span>, <span class="dv">3</span>],</span>
<span id="cb46-66"><a href="#cb46-66" tabindex="-1"></a>        <span class="st">'percentage'</span>: [<span class="fl">40.0</span>, <span class="fl">60.0</span>],</span>
<span id="cb46-67"><a href="#cb46-67" tabindex="-1"></a>    }, index<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb46-68"><a href="#cb46-68" tabindex="-1"></a></span>
<span id="cb46-69"><a href="#cb46-69" tabindex="-1"></a>    actual_result <span class="op">=</span> summarise_categorical(test_input, <span class="st">"country"</span>)</span>
<span id="cb46-70"><a href="#cb46-70" tabindex="-1"></a></span>
<span id="cb46-71"><a href="#cb46-71" tabindex="-1"></a>    pdt.assert_frame_equal(actual_result, expected_result)</span>
<span id="cb46-72"><a href="#cb46-72" tabindex="-1"></a></span>
<span id="cb46-73"><a href="#cb46-73" tabindex="-1"></a></span>
<span id="cb46-74"><a href="#cb46-74" tabindex="-1"></a><span class="kw">def</span> test_summarise_categorical_missvals():</span>
<span id="cb46-75"><a href="#cb46-75" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb46-76"><a href="#cb46-76" tabindex="-1"></a><span class="co">    Test that summarise_categorical correctly tabulates</span></span>
<span id="cb46-77"><a href="#cb46-77" tabindex="-1"></a><span class="co">    distribution of values (counts, percentages) for a ground truth</span></span>
<span id="cb46-78"><a href="#cb46-78" tabindex="-1"></a><span class="co">    example (edge case where column contains missing values)</span></span>
<span id="cb46-79"><a href="#cb46-79" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb46-80"><a href="#cb46-80" tabindex="-1"></a>    test_input <span class="op">=</span> pd.DataFrame({</span>
<span id="cb46-81"><a href="#cb46-81" tabindex="-1"></a>        <span class="st">'country'</span>: [<span class="st">'USA'</span>, <span class="st">'USA'</span>, <span class="st">'USA'</span>, <span class="st">"Russia"</span>, pd.NA],</span>
<span id="cb46-82"><a href="#cb46-82" tabindex="-1"></a>    }, index<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb46-83"><a href="#cb46-83" tabindex="-1"></a></span>
<span id="cb46-84"><a href="#cb46-84" tabindex="-1"></a>    expected_result <span class="op">=</span> pd.DataFrame({</span>
<span id="cb46-85"><a href="#cb46-85" tabindex="-1"></a>        <span class="st">'country'</span>: [<span class="st">"Russia"</span>, <span class="st">"USA"</span>, np.nan],</span>
<span id="cb46-86"><a href="#cb46-86" tabindex="-1"></a>        <span class="st">'count'</span>: [<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>],</span>
<span id="cb46-87"><a href="#cb46-87" tabindex="-1"></a>        <span class="st">'percentage'</span>: [<span class="fl">20.0</span>, <span class="fl">60.0</span>, <span class="fl">20.0</span>],</span>
<span id="cb46-88"><a href="#cb46-88" tabindex="-1"></a>    }, index<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb46-89"><a href="#cb46-89" tabindex="-1"></a>    actual_result <span class="op">=</span> summarise_categorical(test_input, <span class="st">"country"</span>)</span>
<span id="cb46-90"><a href="#cb46-90" tabindex="-1"></a></span>
<span id="cb46-91"><a href="#cb46-91" tabindex="-1"></a>    pdt.assert_frame_equal(actual_result, expected_result)</span>
<span id="cb46-92"><a href="#cb46-92" tabindex="-1"></a>    </span>
<span id="cb46-93"><a href="#cb46-93" tabindex="-1"></a></span>
<span id="cb46-94"><a href="#cb46-94" tabindex="-1"></a></span>
<span id="cb46-95"><a href="#cb46-95" tabindex="-1"></a><span class="kw">def</span> test_summarise_categorical_invalid():</span>
<span id="cb46-96"><a href="#cb46-96" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb46-97"><a href="#cb46-97" tabindex="-1"></a><span class="co">    Test that summarise_categorical raises an</span></span>
<span id="cb46-98"><a href="#cb46-98" tabindex="-1"></a><span class="co">    error when a non-existent column is input</span></span>
<span id="cb46-99"><a href="#cb46-99" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb46-100"><a href="#cb46-100" tabindex="-1"></a>    test_input <span class="op">=</span> pd.DataFrame({</span>
<span id="cb46-101"><a href="#cb46-101" tabindex="-1"></a>        <span class="st">'country'</span>: [<span class="st">'USA'</span>, <span class="st">'USA'</span>, <span class="st">'USA'</span>, <span class="st">"Russia"</span>, <span class="st">"Russia"</span>],</span>
<span id="cb46-102"><a href="#cb46-102" tabindex="-1"></a>    }, index<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb46-103"><a href="#cb46-103" tabindex="-1"></a></span>
<span id="cb46-104"><a href="#cb46-104" tabindex="-1"></a>    <span class="cf">with</span> pytest.raises(<span class="pp">KeyError</span>):</span>
<span id="cb46-105"><a href="#cb46-105" tabindex="-1"></a>        summarise_categorical(test_input, <span class="st">"vehicle"</span>)</span></code></pre>
</div>
<p>Finally lets commit our test suite to our codebase and push the
changes to GitHub.</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> git add eva_data_analysis.py </span>
<span id="cb47-2"><a href="#cb47-2" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> git commit <span class="at">-m</span> <span class="st">"Add additional analysis functions"</span></span>
<span id="cb47-3"><a href="#cb47-3" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> git add tests/</span>
<span id="cb47-4"><a href="#cb47-4" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> git commit <span class="at">-m</span> <span class="st">"Add test suite"</span></span>
<span id="cb47-5"><a href="#cb47-5" tabindex="-1"></a><span class="kw">(</span><span class="ex">venv_spacewalks</span><span class="kw">)</span> <span class="ex">$</span> git push origin main</span></code></pre>
</div>
</section><section><h2 class="section-heading" id="continuous-integration-for-automated-testing">Continuous Integration for automated testing<a class="anchor" aria-label="anchor" href="#continuous-integration-for-automated-testing"></a></h2>
<hr class="half-width"><p>Continuous Integration (CI) services provide the infrastructure to
automatically run the code’s test suite every time changes are pushed to
a remote repository. There is an <a href="ci-for-testing.html">extra
episode on configuring CI for automated tests on GitHub</a> for some
additional reading.</p>
</section><section><h2 class="section-heading" id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a></h2>
<hr class="half-width"><p>During this episode, we have covered how to use software tests to
verify the correctness of our code. We have seen how to write a unit
test, how to manage and run our tests using the pytest framework and how
identify which parts of our code require additional testing using test
coverage reports.</p>
<p>These skills reduce the probability that there will be a “mistake in
our code” and support reproducible research by giving us the confidence
to engage in open research practices. Tests also document the intended
behaviour of our code for other developers and mean that we can
experiment with changes to our code knowing that our tests will let us
know if we break any existing functionality. In other words, software
testing supports the FAIR software principles by making our code more
<strong>accessible</strong> and <strong>reusable</strong>.</p>
</section><section><h2 class="section-heading" id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a></h2>
<hr class="half-width"><p>We recommend the following resources for some additional reading on
the topic of this episode:</p>
<ul><li>
<a href="https://swcarpentry.github.io/python-novice-inflammation/10-defensive.html" class="external-link">The
Defensive Programming episode</a> from the Software Carpentry Python
Programming lesson</li>
<li>
<a href="https://www.software.ac.uk/blog/using-python-double-check-your-work" class="external-link">Using
Python to double check your work</a> (Software Sustainability Blog Post)
by Peter Inglesby</li>
<li>
<a href="https://carpentries-incubator.github.io/python-testing/" class="external-link">The
Python Testing and Continuous Integration</a> lesson on The Carpentries
Incubator by François Michonneau</li>
<li>[Test Driven Development][<a href="https://researchcodingclub.github.io/2019-11-13-test-driven-development/" class="external-link">york-tdd-blog</a>
(University of York Research Coding Club Blog Post) by Peter Hill and
Stephen Biggs-Fox</li>
<li>
<a href="https://coderefinery.github.io/testing/" class="external-link">Automated testing
- Preventing yourself and others from breaking your functioning code</a>
Coderefinery lesson</li>
<li>
<a href="https://carpentries-incubator.github.io/python-intermediate-development/21-automatically-testing-software/index.html" class="external-link">The
Automatically Testing Software episode</a> from the Intermediate
Research Software Development lesson on The Carpentries Incubator by
Aleksandra Nenadic et al.</li>
</ul><p>Also check the <a href="reference.html#litref">full reference set</a>
for the course.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ol style="list-style-type: decimal"><li>Code testing supports the FAIR principles by improving the
accessibility and re-usability of research code.</li>
<li>Unit testing is crucial as it ensures each functions works
correctly.</li>
<li>Using the <code>pytest</code> framework, you can write basic unit
tests for Python functions to verify their correctness.</li>
<li>Identifying and handling edge cases in unit tests is essential to
ensure your code performs correctly under a variety of conditions.</li>
<li>Test coverage can help you to identify parts of your code that
require additional testing.</li>
<li>
</li>
</ol></div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="07-code-structure.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="09-code-documentation.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="07-code-structure.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Code structure
        </a>
        <a class="chapter-link float-end" href="09-code-documentation.html" rel="next">
          Next: Code documentation...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/softwaresaved/fair-research-software/edit/main/episodes/08-code-correctness.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/softwaresaved/fair-research-software/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/softwaresaved/fair-research-software/" class="external-link">Source</a></p>
				<p><a href="https://github.com/softwaresaved/fair-research-software/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:a.nenadic@software.ac.uk">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.7" class="external-link">sandpaper (0.16.7)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.6" class="external-link">pegboard (0.7.6)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.4" class="external-link">varnish (1.0.4)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://softwaresaved.github.io/fair-research-software/08-code-correctness.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, FAIR, reproducibility, sustainability, open, research, lesson, The Carpentries",
  "name": "Code correctness",
  "creativeWorkStatus": "active",
  "url": "https://softwaresaved.github.io/fair-research-software/08-code-correctness.html",
  "identifier": "https://softwaresaved.github.io/fair-research-software/08-code-correctness.html",
  "dateCreated": "2023-10-03",
  "dateModified": "2024-09-17",
  "datePublished": "2024-09-24"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

